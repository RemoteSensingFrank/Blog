---
title: 直方图匹配与方差调整
date: 2017-02-22 11:49:53
categories: 图像处理
tags: 图像处理的数学原理
---

&nbsp;&nbsp;&nbsp;&nbsp;在图像处理的过程中由于影像量化等级的影响，不同传感器获取的数据在影像方差和均值上具有较大的差异，在不同的数据进行融合的处理中如何处理由于量化等级差异导致的误差是一个较为困难的问题，而不同的影像的差异体现在影像的均值和方差上，影像的均值可以直接通过均值调整的方法进行调整，然而影像方差的调整却较为困难。   
&nbsp;&nbsp;&nbsp;&nbsp;实际上，不同量化等级之间的区别类似于离散值与连续值的区别，在量化的等级较高的影像上，我们能够轻易的区分出两种辐射亮度差别较小的地物，而在量化等级较低的影像中我们难以对此两类地物进行区分，这种混淆与影像分辨率无关。但是由于量化等级的差异而导致的影像分辨率的降低与由于视场角而造成的影像分辨率的差异造成的影响在视觉上表现有些类似。  
下图展示了由于影像量化等级差异导致的差异：
<center>![不同量化等级造成的影像差异](https://lh3.googleusercontent.com/-GLByXZ6ihsE/WK2DK76RCuI/AAAAAAAACJs/mq8NRNJcrEEtmjXWbznBNMGLYXbtc6QCgCLcB/s0/QQ%25E6%2588%25AA%25E5%259B%25BE20170222200505.jpg "QQ截图20170222200505.jpg")  </center>
&nbsp;&nbsp;&nbsp;&nbsp;其中左图为量化等级较低的传感获取的影像，右图为量化等级较高的传感器获取的影像，从图上来看，九个像素在辐射强度上存在差异，然而由于量化等级较低因此左图无法对其进行区分，在图像的上表现为同一物，而右图能够对其进行较好的表现。而采用不同量化等级的影像进行修补和融合的过程中也会出现以上问题，由于量化等级的差异引起的影像分辨力的差异，一般来说对于不同传感器获取的影像需要先进行直方图匹配，然后再进行融合。直方图匹配的公式为：
<center><img src="http://latex.codecogs.com/gif.latex? S=T(r)=(L-1)\int_0^rPr(w)dw(1)" />  
<center><img src="http://latex.codecogs.com/gif.latex? G(z)=(L-1)\int_0^rPz(t)dt=S(2)" />  
<center><img src="http://latex.codecogs.com/gif.latex? Z=G^{-1}[T(r)]=G^{-1}(S)(3)" />  

&nbsp;&nbsp;&nbsp;&nbsp;上式中r与z为连续随机变量，P(r)与P(z)为它们所对对应的概率密度函数，则通过式（1）可以是的其分布函数均匀分布，由此可得式（1）为直方图均衡化，对于两个变量r与z，假设其分布都为均匀分布，则其分布直方图完全一致，我们将均匀分布作为一个中间量，则可得式（3），则我们可得式（3）为直方图匹配的公式。  
&nbsp;&nbsp;&nbsp;&nbsp;实际上在直方图匹配的过程中我们考虑到了影像灰度直方图的分布特点，在此基础上进行了调整，虽然经过直方图匹配后影像能够在色调上保持比较好的一致性，且通过拉伸能够较好的提高影像的量化级别，通过调整后的影像方差比较我们可知，如果目标直方图具有较高的量化等级，则实际上通过直方图匹配后影像方差变大了，看似影像信息量得到了增加，实际上并没有改变我们刚刚讨论的由于量化等级的差异而引起的分辨率的差异，实际上此类差异在没有其他信息的情况下难以进行调整，也就是说如果不引入其他信息，单纯的想用量化等级较低的高分影像去对量化等级较高的影像进行修复，在修复理论上存在一定的困难。因为不管如何进行调整，我们无法在实际上对其量化等级进行提升。因此采用高分影像进行填补后的数据可能只能作为进一步修复的参考，且由于量化等级的问题，采用光谱域变换的方法可能对修补区域无法进行较好的修复。
实际证明如下：
&nbsp;&nbsp;&nbsp;&nbsp;在光谱域的修复中通过光谱域变换能够将各个波段的信息集中到第一波段，通过对第一波段的强度进行调整然后反变换，能够得到较好的修复效果，但是采用高分影像进行修复后，由于量化等级造成原始光谱在强度上没有差异，则变换后和调整后光谱依旧没有差异，最后反变换后其光谱值依旧相同，因此无法达到提高信息量，对影像进行修复的目的。
基于PCA的光谱域的变换表示为：  
<center><img src="http://latex.codecogs.com/gif.latex? S^t=S\cdot M(4)" />  

其中S为原始光谱，M为变换矩阵，在PCA变换中M矩阵为波段之间的协方差矩阵。则其反变换为：
 <center><img src="http://latex.codecogs.com/gif.latex? S=S^t\cdot M^{-1}(5)"/>  

 &nbsp;&nbsp;&nbsp;&nbsp;通过时（4）（5）可知，对于同一输入，通过光谱域变换得到同一输出，则参看由于量化等级导致的差异图可以看到，及时经过调整和变换，由于量化等地导致的差异依旧无法消除，由于可得即使通过变换，依旧难以得到较好的修复和融合效果，为了得到较好的效果，必须由高量化等级的数据对低量化等级的数据进行推测，或通过一定的形式将低量化等级的数据与高量化等级的数据进行匹配，从高量化等级数据通过像素建立关系，这样才能获取到较好的修复和处理效果，否则只通过直方图的方法进行调整，看似提高了影像方差，增加了信息量，实际上由于量化等级带来的误差并没有得到消除，其造成的影响依旧存在。
